#!/usr/bin/make -f
# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1

DOCDIR=htmldoc
HELPXML=$(DOCDIR)/tidy5-help.xml
CONFIGXML=$(DOCDIR)/tidy5-config.xml
MANXSL=$(DOCDIR)/tidy1.xsl
MANPAGE=debian/tidy5.1
VERSION=`cat version.txt`

override_dh_auto_build:
	cmake . -DCMAKE_INSTALL_PREFIX=/usr -DBUILD_SHARED_LIB:BOOL=TRUE
	make
	echo "************ Step2 *************"
	## Generate manpage from tidy output
	LD_LIBRARY_PATH=$${LD_LIBRARY_PATH:+$$LD_LIBRARY_PATH:}$(CURDIR) \
		$(CURDIR)/tidy5 -xml-help > $(HELPXML)
	LD_LIBRARY_PATH=$${LD_LIBRARY_PATH:+$$LD_LIBRARY_PATH:}$(CURDIR) \
		$(CURDIR)/tidy5 -xml-config > $(CONFIGXML)
	/usr/bin/xsltproc -o $(MANPAGE) $(MANXSL) $(HELPXML)

override_dh_makeshlibs:
	dh_makeshlibs -V "libtidy5 (>= $(VERSION))"

override_dh_auto_install:
	DESTDIR=$(CURDIR)/debian/tmp make install

override_dh_auto_clean:
	dh_auto_clean
	## Clean up generated files
	rm -f $(MANPAGE)
	rm -f $(HELPXML)
	rm -f $(CONFIGXML)

%:
	dh $@
